{"version":3,"file":"pp-breadcrumbs.umd.js","sources":["../../../projects/pp-breadcrumbs/src/lib/breadcrumbs.resolver.ts","../../../projects/pp-breadcrumbs/src/lib/breadcrumbs.service.ts","../../../projects/pp-breadcrumbs/src/lib/breadcrumbs.component.ts","../../../projects/pp-breadcrumbs/src/lib/breadcrumbs.module.ts","../../../projects/pp-breadcrumbs/src/public_api.ts","../../../projects/pp-breadcrumbs/src/pp-breadcrumbs.ts"],"sourcesContent":["import {ActivatedRouteSnapshot, Resolve, RouterStateSnapshot, UrlSegment} from '@angular/router';\r\nimport {Observable, of} from 'rxjs';\r\nimport {Breadcrumb} from './breadcrumb';\r\nimport {Injectable} from '@angular/core';\r\nimport {template} from 'lodash';\r\n\r\n@Injectable()\r\nexport class PpBreadcrumbsResolver implements Resolve<Breadcrumb[]> {\r\n\r\n  resolve(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): Observable<Breadcrumb[]> | Promise<Breadcrumb[]> | Breadcrumb[] {\r\n    const data = route.routeConfig.data;\r\n    const path = this.getFullPath(route);\r\n    const rawText = typeof data.breadcrumbs === 'string' ? data.breadcrumbs : data.breadcrumbs.text || data.text || path;\r\n\r\n    return of([\r\n      {\r\n        path: path,\r\n        text: this.stringFormat(rawText, route.data)\r\n      }\r\n    ]);\r\n  }\r\n\r\n  protected getFullPath(route: ActivatedRouteSnapshot): string {\r\n    const relativePath = (segments: UrlSegment[]) => segments.reduce((a, v) => (a += '/' + v.path), '');\r\n    const fullPath = (routes: ActivatedRouteSnapshot[]) => routes.reduce((a, v) => (a += relativePath(v.url)), '');\r\n    return fullPath(route.pathFromRoot);\r\n  }\r\n\r\n  protected stringFormat(templateString: string, binding: any): string {\r\n    const compiled = template(templateString, { interpolate: /{{(.+?)}}/g });\r\n    return compiled(binding);\r\n  }\r\n}\r\n","import {Injectable, Injector, OnDestroy, Type} from '@angular/core';\r\nimport {ActivatedRouteSnapshot, NavigationEnd, Router} from '@angular/router';\r\nimport {BehaviorSubject, concat, from, isObservable, Observable, of, Subscription} from 'rxjs';\r\n\r\nimport {PpBreadcrumbsResolver} from './breadcrumbs.resolver';\r\nimport {concatMap, distinct, filter, first, mergeMap, tap, toArray} from 'rxjs/operators';\r\nimport {Breadcrumb} from './breadcrumb';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PpBreadcrumbsService implements OnDestroy {\r\n\r\n  postProcess: (crumbs: Breadcrumb[]) => Promise<Breadcrumb[]> | Observable<Breadcrumb[]> | Breadcrumb[];\r\n\r\n  protected breadcrumbs = new BehaviorSubject<Breadcrumb[]>([]);\r\n  protected defaultResolver = new PpBreadcrumbsResolver();\r\n  protected subscription?: Subscription;\r\n\r\n  get crumbs$(): Observable<Breadcrumb[]> {\r\n    return this.breadcrumbs.asObservable();\r\n  }\r\n\r\n  constructor(protected router: Router, protected injector: Injector) {\r\n    this.subscription = this.router.events.pipe(\r\n      filter(x => x instanceof NavigationEnd),\r\n      concatMap(() => this.onNavigationEnd())\r\n    ).subscribe();\r\n\r\n    this.onNavigationEnd().subscribe();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscription?.unsubscribe();\r\n    this.breadcrumbs.complete();\r\n  }\r\n\r\n  protected onNavigationEnd() {\r\n    return this.resolveCrumbs(this.router.routerState.snapshot.root).pipe(\r\n      mergeMap((breadcrumbs) => breadcrumbs),\r\n      distinct((breadcrumb) => breadcrumb.text),\r\n      toArray(),\r\n      mergeMap((breadcrumbs) => {\r\n        return this.postProcess ? this.wrapIntoObservable(this.postProcess(breadcrumbs)).pipe(first()) : of(breadcrumbs);\r\n      }),\r\n      tap((breadcrumbs) => this.breadcrumbs.next(breadcrumbs))\r\n    );\r\n  }\r\n\r\n  protected resolveCrumbs(route: ActivatedRouteSnapshot): Observable<Breadcrumb[]> {\r\n    let crumbs$: Observable<Breadcrumb[]> = of([]);\r\n    const data = route.routeConfig?.data;\r\n\r\n    if (data?.breadcrumbs) {\r\n      const resolver = this.getBreadcrumbResolver(data.breadcrumbs);\r\n      const result = resolver.resolve(route, this.router.routerState.snapshot);\r\n      crumbs$ = this.wrapIntoObservable(result).pipe(first());\r\n    }\r\n\r\n    return route.firstChild ? concat(crumbs$, this.resolveCrumbs(route.firstChild)) : crumbs$;\r\n  }\r\n\r\n  protected getBreadcrumbResolver(breadcrumbs: string | Type<PpBreadcrumbsResolver>): PpBreadcrumbsResolver {\r\n    return typeof breadcrumbs === 'function' && breadcrumbs.prototype instanceof PpBreadcrumbsResolver\r\n      ? this.injector.get<PpBreadcrumbsResolver>(breadcrumbs)\r\n      : this.defaultResolver;\r\n  }\r\n\r\n  protected wrapIntoObservable<T>(value: T | Promise<T> | Observable<T>): Observable<T> {\r\n    return isObservable(value) ? value : from(Promise.resolve(value));\r\n  }\r\n}\r\n","import {Component, OnDestroy, OnInit} from '@angular/core';\r\nimport {Subscription} from 'rxjs';\r\nimport {Breadcrumb} from './breadcrumb';\r\nimport {PpBreadcrumbsService} from './breadcrumbs.service';\r\n\r\n@Component({\r\n  selector: 'pp-breadcrumbs',\r\n  templateUrl: './breadcrumbs.component.html',\r\n  styleUrls: ['./breadcrumbs.component.scss']\r\n})\r\nexport class PpBreadcrumbsComponent implements OnInit, OnDestroy {\r\n  crumbs: Breadcrumb[];\r\n\r\n  protected subscription?: Subscription;\r\n\r\n  constructor(protected service: PpBreadcrumbsService) {}\r\n\r\n  public ngOnInit(): void {\r\n    this.subscription = this.service.crumbs$.subscribe((crumbs) => {\r\n      this.crumbs = crumbs;\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscription?.unsubscribe();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport {RouterModule} from '@angular/router';\r\nimport {CommonModule} from '@angular/common';\r\n\r\nimport { PpBreadcrumbsComponent } from './breadcrumbs.component';\r\n\r\n@NgModule({\r\n  declarations: [PpBreadcrumbsComponent],\r\n  imports: [CommonModule, RouterModule],\r\n  exports: [PpBreadcrumbsComponent]\r\n})\r\nexport class PpBreadcrumbsModule { }\r\n","/*\r\n * Public API Surface of pp-breadcrumbs\r\n */\r\n\r\nexport * from './lib/breadcrumb';\r\nexport * from './lib/breadcrumbs.service';\r\nexport * from './lib/breadcrumbs.component';\r\nexport * from './lib/breadcrumbs.resolver';\r\nexport * from './lib/breadcrumbs.module';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["of","template","Injectable","BehaviorSubject","filter","NavigationEnd","concatMap","mergeMap","distinct","toArray","first","tap","concat","isObservable","from","Router","Injector","Component","NgModule","CommonModule","RouterModule"],"mappings":"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"}